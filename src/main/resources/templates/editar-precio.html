<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" th:href="@{/css/editar-p.css}" />
       <link rel="icon" th:href="@{/img/loguito.jpeg}" type="image/x-icon">
    <title>Editar Precio - Panel Administrador</title>
 
</head>
<body>
    <div class="container">
        <div class="form-header">
            <h2>‚úèÔ∏è Editar Precio</h2>
        </div>
        
        <form th:action="@{/precios/actualizar}" th:object="${precio}" method="post" id="editForm">
            <input type="hidden" th:field="*{id}">
            
            <!-- Selector de Actividad -->
            <div class="form-group">
                <label for="actividad">üè∑Ô∏è Actividad:</label>
                <select id="actividad" th:field="*{actividad}" required onchange="mostrarCamposDinamicos()">
                    <option value="">Seleccionar actividad</option>
                    <option value="maquina">üè≠ M√°quina</option>
                    <option value="corte">‚úÇÔ∏è Corte</option>
                    <option value="empaque">üì¶ Empaque</option>
                </select>
            </div>

            <!-- Campos din√°micos para M√°quina -->
            <div id="campos-maquina" class="dynamic-fields">
                <h3>üè≠ Configuraci√≥n de M√°quina</h3>
                   <div class="form-group">
                    <label for="desc-maquina">Tipo de S√°banas:</label>
                    <select id="desc-maquina" name="descripcion-temp">
                        <option value="">Seleccionar tipo</option>
                        <option value="Plana">üõèÔ∏è Plana</option>
                        <option value="Caucho">üîÑ Caucho</option>
                        <option value="Fundas">üõ°Ô∏è Fundas</option>
                    </select>
                </div>
            </div>
            
            <!-- Campos din√°micos para Corte -->
            <div id="campos-corte" class="dynamic-fields">
                <h3>‚úÇÔ∏è Configuraci√≥n de Corte</h3>
                <div class="form-group">
                    <label for="desc-corte">Descripci√≥n del Corte:</label>
                    <input type="text" id="desc-corte" name="descripcion-temp" 
                           placeholder="Ej: Juego completo, Individual, S√°bana sencilla...">
                </div>
            </div>
            
            <!-- Campos din√°micos para Empaque -->
            <div id="campos-empaque" class="dynamic-fields">
                <h3>üì¶ Configuraci√≥n de Empaque</h3>
                <div class="form-group">
                    <label for="desc-empaque">Tipo de Empaque:</label>
                    <select id="desc-empaque" name="descripcion-temp">
                        <option value="">Seleccionar tipo</option>
                        <option value="Bolsa">üõçÔ∏è Bolsa</option>
                        <option value="Cart√≥n">üì¶ Cart√≥n</option>
                    </select>
                </div>
            </div>

            <!-- Campo oculto para la descripci√≥n real -->
            <input type="hidden" th:field="*{descripcion}" id="descripcion-real">

            <!-- Campo de precio -->
            <div class="form-group">
                <label for="precio">üí∞ Precio (COP):</label>
                <input type="number" th:field="*{precio}" id="precio" 
                       placeholder="Ingrese el precio" min="1" max="50000" required>
                <div class="price-display">
                    üíµ Precio actual: $<span th:text="${#numbers.formatInteger(precio.precio, 0, 'COMMA')}">0</span> COP
                </div>
                <div id="precio-error" class="validation-error" style="display: none;"></div>
            </div>

            <!-- Informaci√≥n del registro actual -->
            <div class="alert alert-info">
                <strong>üìù Editando:</strong> 
                <span th:text="*{descripcion}">Descripci√≥n</span> 
                (<span th:text="*{actividad}">actividad</span>)
                <br>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ Actualizar Precio</button>
                <a th:href="@{/precios}" class="btn btn-secondary">‚ùå Cancelar</a>
            </div>
        </form>
    </div>

    <script>
        // Variables globales
        let formularioValido = false;
        
        // Funci√≥n para mostrar/ocultar campos seg√∫n actividad
        function mostrarCamposDinamicos() {
            const actividad = document.getElementById('actividad').value;
            const camposMaquina = document.getElementById('campos-maquina');
            const camposCorte = document.getElementById('campos-corte');
            const camposEmpaque = document.getElementById('campos-empaque');
            
            // Ocultar todos los campos
            camposMaquina.classList.remove('active');
            camposCorte.classList.remove('active');
            camposEmpaque.classList.remove('active');
            
            // Limpiar valores previos
            document.getElementById('desc-maquina').value = '';
            document.getElementById('desc-corte').value = '';
            document.getElementById('desc-empaque').value = '';
            
            // Mostrar campos seg√∫n actividad seleccionada
            switch(actividad) {
                case 'maquina':
                    camposMaquina.classList.add('active');
                    break;
                case 'corte':
                    camposCorte.classList.add('active');
                    break;
                case 'empaque':
                    camposEmpaque.classList.add('active');
                    break;
            }
            
            // Actualizar el campo oculto de descripci√≥n
            actualizarDescripcion();
        }
        
        // Funci√≥n para actualizar la descripci√≥n en el campo oculto
        function actualizarDescripcion() {
            const actividad = document.getElementById('actividad').value;
            const descripcionReal = document.getElementById('descripcion-real');
            let descripcion = '';
            
            switch(actividad) {
                case 'maquina':
                    descripcion = document.getElementById('desc-maquina').value;
                    break;
                case 'corte':
                    descripcion = document.getElementById('desc-corte').value.trim();
                    break;
                case 'empaque':
                    descripcion = document.getElementById('desc-empaque').value;
                    break;
            }
            
            descripcionReal.value = descripcion;
            validarFormulario();
        }
        
        // Funci√≥n para establecer el valor inicial
        function establecerValorInicial() {
            const actividadActual = document.getElementById('actividad').value;
            const descripcionActual = document.getElementById('descripcion-real').value;
            
            // Mostrar campos correctos
            mostrarCamposDinamicos();
            
            // Establecer valor en el campo correspondiente
            switch(actividadActual) {
                case 'maquina':
                    document.getElementById('desc-maquina').value = descripcionActual;
                    break;
                case 'corte':
                    document.getElementById('desc-corte').value = descripcionActual;
                    break;
                case 'empaque':
                    document.getElementById('desc-empaque').value = descripcionActual;
                    break;
            }
            
            // Actualizar descripci√≥n final
            actualizarDescripcion();
        }
        
        // Funci√≥n de validaci√≥n
        function validarFormulario() {
            const actividad = document.getElementById('actividad').value;
            const descripcion = document.getElementById('descripcion-real').value;
            const precio = parseInt(document.getElementById('precio').value);
            const precioError = document.getElementById('precio-error');
            
            // Validar precio
            if (precio && (precio <= 0 || precio > 50000)) {
                precioError.textContent = precio <= 0 ? 
                    '‚ö†Ô∏è El precio debe ser mayor a 0' : 
                    '‚ö†Ô∏è El precio no puede exceder $50,000';
                precioError.style.display = 'block';
                formularioValido = false;
            } else {
                precioError.style.display = 'none';
                formularioValido = true;
            }
            
            return formularioValido && actividad && descripcion && precio;
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer valores iniciales
            establecerValorInicial();
            
            // Agregar listeners para actualizar descripci√≥n
            document.getElementById('desc-maquina').addEventListener('change', actualizarDescripcion);
            document.getElementById('desc-corte').addEventListener('input', actualizarDescripcion);
            document.getElementById('desc-empaque').addEventListener('change', actualizarDescripcion);
            
            // Validaci√≥n en tiempo real del precio
            document.getElementById('precio').addEventListener('input', validarFormulario);
            
            // Validar formulario al enviar
            document.getElementById('editForm').addEventListener('submit', function(e) {
                const actividad = document.getElementById('actividad').value;
                const descripcion = document.getElementById('descripcion-real').value;
                const precio = document.getElementById('precio').value;
                
                // Validaciones
                if (!actividad) {
                    alert('‚ö†Ô∏è Debe seleccionar una actividad');
                    e.preventDefault();
                    return false;
                }
                
                if (!descripcion || descripcion.trim() === '') {
                    alert('‚ö†Ô∏è Debe completar la descripci√≥n');
                    e.preventDefault();
                    return false;
                }
                
                if (!precio || precio <= 0) {
                    alert('‚ö†Ô∏è El precio debe ser mayor a 0');
                    e.preventDefault();
                    return false;
                }
                
                if (precio > 50000) {
                    alert('‚ö†Ô∏è El precio no puede exceder $50,000');
                    e.preventDefault();
                    return false;
                }
                
                // Confirmar actualizaci√≥n
                const confirmar = confirm(
                    `üîÑ ¬øConfirmar actualizaci√≥n?\n\n` +
                    `Actividad: ${actividad}\n` +
                    `Descripci√≥n: ${descripcion}\n` +
                    `Nuevo precio: $${parseInt(precio).toLocaleString()} COP`
                );
                
                if (!confirmar) {
                    e.preventDefault();
                    return false;
                }
                
                // Mostrar indicador de carga
                const submitBtn = document.querySelector('.btn-primary');
                submitBtn.innerHTML = '‚è≥ Actualizando...';
                submitBtn.disabled = true;
                
                return true;
            });
        });
        
        // Funci√≥n para formatear n√∫meros
        function formatearPrecio(precio) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(precio);
        }
    </script>
</body>
</html>